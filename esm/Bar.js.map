{"version":3,"file":"Bar.js","sources":["../src/Bar.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport identity from 'ramda/src/identity';\nimport { axisBottom as d3AxisBottom, axisLeft as d3AxisLeft } from 'd3-axis';\nimport {\n  scaleBand as d3ScaleBand,\n  scaleLinear as d3ScaleLinear,\n} from 'd3-scale';\nimport { select as d3Select } from 'd3-selection';\nimport { timeFormat as d3TimeFormat } from 'd3-time-format';\nimport {\n  Axis,\n  BarDatum,\n  DataGroup,\n  Grid,\n  MainGroup,\n  Label,\n  SVG,\n} from './components';\nimport {\n  debounce,\n  drawGrid,\n  getBaseColor,\n  getId,\n  getMax,\n  getSize,\n  rotateXLabels,\n  setupData,\n} from './utils';\nimport {\n  ASPECT_RATIO,\n  MARGIN,\n  ROTATION,\n  SCALE_PADDING,\n  SIZE,\n  THEME,\n  TICKS,\n  TIME_FORMAT,\n} from './utils/constants';\n\nconst Bar = ({\n  aspectRatio = ASPECT_RATIO,\n  data: chartData,\n  dateFormat = TIME_FORMAT,\n  grid,\n  height: svgHeight = undefined,\n  isHorizontal,\n  margin = MARGIN,\n  onClick = identity,\n  onMouseEnter = identity,\n  onMouseLeave = identity,\n  responsive = false,\n  theme = THEME,\n  width: svgWidth = undefined,\n  xAxisLabel,\n  xAxisLabelRotation,\n  xAxisLabelRotationValue = ROTATION,\n  xAxisTicks = TICKS,\n  xScalePadding = SCALE_PADDING,\n  yAxisLabel,\n  yAxisTicks = TICKS,\n}) => {\n  const svgRef = useRef();\n  const [id] = useState(getId('bar'));\n  const timeFormat = d3TimeFormat(dateFormat);\n  const [{ width, height, isSizeSet }, setSize] = useState(SIZE);\n  const [isDates, data] = setupData(chartData);\n\n  const xScale = d3ScaleBand()\n    .domain(data.map(({ name }) => name))\n    .range([0, width])\n    .padding(xScalePadding);\n\n  const yScale = d3ScaleLinear()\n    .domain([0, getMax(data.map(({ value }) => value))])\n    .range([height, 0]);\n\n  const handleSize = () => {\n    const offsetWidth = svgRef.current.parentElement.offsetWidth;\n    if ((svgWidth || svgHeight) && !isSizeSet) {\n      setSize({\n        ...getSize(svgWidth, svgHeight, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    } else if (offsetWidth !== svgWidth - (margin.left + margin.right)) {\n      setSize({\n        ...getSize(offsetWidth, undefined, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    }\n  };\n\n  const handleResize = debounce(handleSize)();\n\n  useEffect(() => {\n    handleSize();\n    responsive && window.addEventListener('resize', handleResize);\n\n    return () => {\n      responsive && window.removeEventListener('resize', handleResize);\n    };\n  }, []);\n\n  return (\n    <SVG\n      identifier={id}\n      size={{\n        width: svgWidth || width + margin.left + margin.right,\n        height: svgHeight || height + margin.top + margin.bottom,\n      }}\n      ref={svgRef}\n    >\n      <MainGroup margin={margin}>\n        {grid && (\n          <Grid\n            ref={node =>\n              d3Select(node).call(\n                drawGrid(\n                  isHorizontal,\n                  xScale,\n                  height,\n                  yScale,\n                  width,\n                  xAxisTicks,\n                  yAxisTicks\n                )\n              )\n            }\n          />\n        )}\n\n        {xAxisLabel && (\n          <Label axis=\"x\" margin={margin} width={width} height={height}>\n            {xAxisLabel}\n          </Label>\n        )}\n\n        {yAxisLabel && (\n          <Label axis=\"y\" margin={margin} width={width} height={height}>\n            {yAxisLabel}\n          </Label>\n        )}\n\n        <DataGroup>\n          {data.map(({ name, value }, idx) => (\n            <BarDatum\n              key={idx}\n              datum={{\n                name,\n                value,\n              }}\n              color={getBaseColor(theme)}\n              x={xScale(name)}\n              y={yScale(value)}\n              width={xScale.bandwidth()}\n              height={height - yScale(value)}\n              onClick={onClick}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n            />\n          ))}\n        </DataGroup>\n\n        <Axis\n          axis=\"x\"\n          position={{ x: 0, y: height }}\n          ref={node => {\n            d3Select(node).call(\n              d3AxisBottom(xScale)\n                .ticks(yAxisTicks)\n                .tickFormat(isDates ? timeFormat : null)\n            );\n            xAxisLabelRotation && rotateXLabels(id, xAxisLabelRotationValue);\n          }}\n        />\n        <Axis\n          axis=\"y\"\n          ref={node =>\n            d3Select(node).call(d3AxisLeft(yScale).ticks(yAxisTicks))\n          }\n        />\n      </MainGroup>\n    </SVG>\n  );\n};\n\nexport default Bar;\n"],"names":["Bar","aspectRatio","ASPECT_RATIO","chartData","data","dateFormat","TIME_FORMAT","grid","height","svgHeight","undefined","isHorizontal","margin","MARGIN","onClick","identity","onMouseEnter","onMouseLeave","responsive","theme","THEME","width","svgWidth","xAxisLabel","xAxisLabelRotation","xAxisLabelRotationValue","ROTATION","xAxisTicks","TICKS","xScalePadding","SCALE_PADDING","yAxisLabel","yAxisTicks","svgRef","useRef","useState","getId","id","timeFormat","d3TimeFormat","SIZE","isSizeSet","setSize","setupData","isDates","xScale","d3ScaleBand","domain","map","name","range","padding","yScale","d3ScaleLinear","getMax","value","handleSize","offsetWidth","current","parentElement","getSize","left","right","handleResize","debounce","useEffect","window","addEventListener","removeEventListener","top","bottom","node","d3Select","call","drawGrid","idx","getBaseColor","bandwidth","x","y","d3AxisBottom","ticks","tickFormat","rotateXLabels","d3AxisLeft"],"mappings":"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"}