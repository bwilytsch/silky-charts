{"version":3,"file":"Bar.js","sources":["../src/Bar.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport identity from 'ramda/src/identity';\nimport { axisBottom as d3AxisBottom, axisLeft as d3AxisLeft } from 'd3-axis';\nimport {\n  scaleBand as d3ScaleBand,\n  scaleLinear as d3ScaleLinear,\n} from 'd3-scale';\nimport { select as d3Select } from 'd3-selection';\nimport { timeFormat as d3TimeFormat } from 'd3-time-format';\nimport {\n  Axis,\n  BarDatum,\n  DataGroup,\n  Grid,\n  MainGroup,\n  Label,\n  SVG,\n} from './components';\nimport {\n  debounce,\n  drawGrid,\n  getBaseColor,\n  getId,\n  getMax,\n  getSize,\n  rotateXLabels,\n  setupData,\n} from './utils';\nimport {\n  ASPECT_RATIO,\n  MARGIN,\n  ROTATION,\n  SCALE_PADDING,\n  SIZE,\n  THEME,\n  TICKS,\n  TIME_FORMAT,\n} from './utils/constants';\n\nconst Bar = ({\n  aspectRatio = ASPECT_RATIO,\n  data: chartData,\n  dateFormat = TIME_FORMAT,\n  grid,\n  height: svgHeight = undefined,\n  isHorizontal,\n  margin = MARGIN,\n  onClick = identity,\n  onMouseEnter = identity,\n  onMouseLeave = identity,\n  responsive = false,\n  theme = THEME,\n  width: svgWidth = undefined,\n  xAxisLabel,\n  xAxisLabelRotation,\n  xAxisLabelRotationValue = ROTATION,\n  xAxisTicks = TICKS,\n  xScalePadding = SCALE_PADDING,\n  yAxisLabel,\n  yAxisTicks = TICKS,\n}) => {\n  const svgRef = useRef();\n  const [id] = useState(getId('bar'));\n  const timeFormat = d3TimeFormat(dateFormat);\n  const [{ width, height, isSizeSet }, setSize] = useState(SIZE);\n  const [isDates, data] = setupData(chartData);\n\n  const xScale = d3ScaleBand()\n    .domain(data.map(({ name }) => name))\n    .range([0, width])\n    .padding(xScalePadding);\n\n  const yScale = d3ScaleLinear()\n    .domain([0, getMax(data.map(({ value }) => value))])\n    .range([height, 0]);\n\n  const handleSize = () => {\n    const offsetWidth = svgRef.current.parentElement.offsetWidth;\n    if ((svgWidth || svgHeight) && !isSizeSet) {\n      setSize({\n        ...getSize(svgWidth, svgHeight, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    } else if (offsetWidth !== svgWidth - (margin.left + margin.right)) {\n      setSize({\n        ...getSize(offsetWidth, undefined, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    }\n  };\n\n  const handleResize = debounce(handleSize)();\n\n  useEffect(() => {\n    handleSize();\n    responsive && window.addEventListener('resize', handleResize);\n\n    return () => {\n      responsive && window.removeEventListener('resize', handleResize);\n    };\n  }, []);\n\n  return (\n    <SVG\n      identifier={id}\n      size={{\n        width: svgWidth || width + margin.left + margin.right,\n        height: svgHeight || height + margin.top + margin.bottom,\n      }}\n      ref={svgRef}\n    >\n      <MainGroup margin={margin}>\n        {grid && (\n          <Grid\n            ref={node =>\n              d3Select(node).call(\n                drawGrid(\n                  isHorizontal,\n                  xScale,\n                  height,\n                  yScale,\n                  width,\n                  xAxisTicks,\n                  yAxisTicks\n                )\n              )\n            }\n          />\n        )}\n\n        {xAxisLabel && (\n          <Label axis=\"x\" margin={margin} width={width} height={height}>\n            {xAxisLabel}\n          </Label>\n        )}\n\n        {yAxisLabel && (\n          <Label axis=\"y\" margin={margin} width={width} height={height}>\n            {yAxisLabel}\n          </Label>\n        )}\n\n        <DataGroup>\n          {data.map(({ name, value }, idx) => (\n            <BarDatum\n              key={idx}\n              datum={{\n                name,\n                value,\n              }}\n              color={getBaseColor(theme)}\n              x={xScale(name)}\n              y={yScale(value)}\n              width={xScale.bandwidth()}\n              height={height - yScale(value)}\n              onClick={onClick}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n            />\n          ))}\n        </DataGroup>\n\n        <Axis\n          axis=\"x\"\n          position={{ x: 0, y: height }}\n          ref={node => {\n            d3Select(node).call(\n              d3AxisBottom(xScale)\n                .ticks(yAxisTicks)\n                .tickFormat(isDates ? timeFormat : null)\n            );\n            xAxisLabelRotation && rotateXLabels(id, xAxisLabelRotationValue);\n          }}\n        />\n        <Axis\n          axis=\"y\"\n          ref={node =>\n            d3Select(node).call(d3AxisLeft(yScale).ticks(yAxisTicks))\n          }\n        />\n      </MainGroup>\n    </SVG>\n  );\n};\n\nexport default Bar;\n"],"names":["aspectRatio","ASPECT_RATIO","chartData","data","dateFormat","TIME_FORMAT","grid","height","svgHeight","undefined","isHorizontal","margin","MARGIN","onClick","identity","onMouseEnter","onMouseLeave","responsive","theme","THEME","width","svgWidth","xAxisLabel","xAxisLabelRotation","xAxisLabelRotationValue","ROTATION","xAxisTicks","TICKS","xScalePadding","SCALE_PADDING","yAxisLabel","yAxisTicks","svgRef","useRef","useState","getId","id","timeFormat","d3TimeFormat","SIZE","isSizeSet","setSize","setupData","isDates","xScale","d3ScaleBand","domain","map","name","range","padding","yScale","d3ScaleLinear","getMax","value","handleSize","offsetWidth","current","parentElement","left","right","getSize","handleResize","debounce","useEffect","window","addEventListener","removeEventListener","React","SVG","identifier","size","top","bottom","ref","MainGroup","Grid","node","d3Select","call","drawGrid","Label","axis","DataGroup","idx","BarDatum","key","datum","color","getBaseColor","x","y","bandwidth","Axis","position","d3AxisBottom","ticks","tickFormat","rotateXLabels","d3AxisLeft"],"mappings":"sXAuCY,oBACVA,YAAAA,aAAcC,IACRC,IAANC,SACAC,WAAAA,aAAaC,IACbC,IAAAA,SACAC,OAAQC,kBAAYC,IACpBC,IAAAA,iBACAC,OAAAA,aAASC,QACTC,QAAAA,aAAUC,QACVC,aAAAA,aAAeD,QACfE,aAAAA,aAAeF,SACfG,WAAAA,wBACAC,MAAAA,eAAQC,UACRC,MAAOC,oBAAWZ,KAClBa,KAAAA,WACAC,KAAAA,wBACAC,wBAAAA,eAA0BC,UAC1BC,WAAAA,eAAaC,UACbC,cAAAA,eAAgBC,KAChBC,KAAAA,gBACAC,WAAAA,eAAaJ,KAEPK,GAASC,OACFC,EAASC,EAAM,QAArBC,cACDC,GAAaC,EAAalC,MACgB8B,EAASK,uBAAhDnB,MAAAA,MAAOb,MAAAA,OAAQiC,MAAAA,UAAaC,YACbC,EAAUxC,cAA3ByC,SAASxC,SAEVyC,GAASC,IACZC,OAAO3C,GAAK4C,IAAI,qBAAGC,QACnBC,MAAM,CAAC,EAAG7B,KACV8B,QAAQtB,IAELuB,GAASC,IACZN,OAAO,CAAC,EAAGO,EAAOlD,GAAK4C,IAAI,qBAAGO,WAC9BL,MAAM,CAAC1C,GAAQ,IAEZgD,GAAa,eACXC,EAAcxB,GAAOyB,QAAQC,cAAcF,aAC5CnC,KAAYb,GAAegC,GAKrBgB,IAAgBnC,IAAYV,EAAOgD,KAAOhD,EAAOiD,QAC1DnB,QACKoB,EAAQL,OAAa/C,EAAWE,EAAQX,IAC3CwC,WAAW,KAPbC,QACKoB,EAAQxC,GAAUb,EAAWG,EAAQX,IACxCwC,WAAW,MAUXsB,GAAeC,EAASR,GAATQ,UAErBC,EAAU,kBACRT,KACAtC,IAAcgD,OAAOC,iBAAiB,SAAUJ,IAEzC,WACL7C,IAAcgD,OAAOE,oBAAoB,SAAUL,MAEpD,IAGDM,gBAACC,GACCC,WAAYlC,GACZmC,KAAM,CACJnD,MAAOC,IAAYD,GAAQT,EAAOgD,KAAOhD,EAAOiD,MAChDrD,OAAQC,GAAaD,GAASI,EAAO6D,IAAM7D,EAAO8D,QAEpDC,IAAK1C,IAELoC,gBAACO,GAAUhE,OAAQA,GAChBL,GACC8D,gBAACQ,GACCF,IAAK,SAAAG,UACHC,EAASD,GAAME,KACbC,EACEtE,EACAkC,GACArC,GACA4C,GACA/B,GACAM,GACAK,QAOTT,IACC8C,gBAACa,GAAMC,KAAK,IAAIvE,OAAQA,EAAQS,MAAOA,GAAOb,OAAQA,IACnDe,IAIJQ,IACCsC,gBAACa,GAAMC,KAAK,IAAIvE,OAAQA,EAAQS,MAAOA,GAAOb,OAAQA,IACnDuB,IAILsC,gBAACe,OACEhF,GAAK4C,IAAI,WAAkBqC,OAAfpC,IAAAA,KAAMM,IAAAA,aACjBc,gBAACiB,GACCC,IAAKF,EACLG,MAAO,CACLvC,KAAAA,EACAM,MAAAA,GAEFkC,MAAOC,EAAavE,IACpBwE,EAAG9C,GAAOI,GACV2C,EAAGxC,GAAOG,GACVlC,MAAOwB,GAAOgD,YACdrF,OAAQA,GAAS4C,GAAOG,GACxBzC,QAASA,EACTE,aAAcA,EACdC,aAAcA,OAKpBoD,gBAACyB,GACCX,KAAK,IACLY,SAAU,CAAEJ,EAAG,EAAGC,EAAGpF,IACrBmE,IAAK,SAAAG,GACHC,EAASD,GAAME,KACbgB,EAAanD,IACVoD,MAAMjE,IACNkE,WAAWtD,GAAUN,GAAa,OAEvCd,IAAsB2E,EAAc9D,GAAIZ,OAG5C4C,gBAACyB,GACCX,KAAK,IACLR,IAAK,SAAAG,UACHC,EAASD,GAAME,KAAKoB,EAAWhD,IAAQ6C,MAAMjE"}