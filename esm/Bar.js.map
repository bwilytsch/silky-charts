{"version":3,"file":"Bar.js","sources":["../src/Bar.js"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport { axisBottom as d3AxisBottom, axisLeft as d3AxisLeft } from 'd3-axis';\nimport {\n  scaleBand as d3ScaleBand,\n  scaleLinear as d3ScaleLinear,\n} from 'd3-scale';\nimport { select as d3Select } from 'd3-selection';\nimport { timeFormat as d3TimeFormat } from 'd3-time-format';\nimport identity from 'ramda/src/identity';\nimport { GraphContext } from './contexts';\nimport {\n  Axis,\n  BarDatum,\n  DataGroup,\n  Grid,\n  Label,\n  MainGroup,\n  DataSource,\n  SVG,\n  Title,\n} from './components';\nimport useResize from './hooks/useResize';\nimport {\n  drawGrid,\n  getBaseColor,\n  getId,\n  getMax,\n  getSize,\n  rotateXLabels,\n  setupData,\n} from './utils';\nimport {\n  ASPECT_RATIO,\n  MARGIN,\n  ROTATION,\n  SCALE_PADDING,\n  SIZE,\n  THEME,\n  X_TICKS,\n  Y_TICKS,\n  TIME_FORMAT,\n} from './utils/constants';\n\nconst Bar = ({\n  aspectRatio = ASPECT_RATIO,\n  data: chartData,\n  dataSource,\n  dateFormat = TIME_FORMAT,\n  grid,\n  height: svgHeight = undefined,\n  horizontal,\n  margin = MARGIN,\n  onClick = identity,\n  onMouseEnter = identity,\n  onMouseLeave = identity,\n  responsive,\n  staticTooltip,\n  theme = THEME,\n  title,\n  tooltip,\n  width: svgWidth = undefined,\n  xAxisChartLabel,\n  xAxisLabelRotation,\n  xAxisLabelRotationValue = ROTATION,\n  xAxisTicks = X_TICKS,\n  padding: xScalePadding = SCALE_PADDING,\n  yAxisChartLabel,\n  yAxisTicks = Y_TICKS,\n}) => {\n  const svgRef = useRef();\n  const [id] = useState(getId('bar'));\n  const timeFormat = d3TimeFormat(dateFormat);\n  const [{ width, height, isSizeSet }, setSize] = useState(SIZE);\n  const [isDates, data] = setupData(chartData);\n\n  const xScale = d3ScaleBand()\n    .domain(data.map(({ name }) => name))\n    .range([0, width])\n    .padding(xScalePadding);\n\n  const yScale = d3ScaleLinear()\n    .domain([0, getMax(data.map(({ value }) => value))])\n    .range([height, 0]);\n\n  const handleSize = () => {\n    const offsetWidth = svgRef.current.parentElement.offsetWidth;\n    if ((svgWidth || svgHeight) && !isSizeSet) {\n      setSize({\n        ...getSize(svgWidth, svgHeight, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    } else if (offsetWidth !== svgWidth - (margin.left + margin.right)) {\n      setSize({\n        ...getSize(offsetWidth, undefined, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    }\n  };\n\n  useResize(responsive, handleSize);\n\n  return (\n    <GraphContext.Provider\n      value={{ margin, node: svgRef.current, staticTooltip }}\n    >\n      <SVG\n        identifier={id}\n        size={{\n          width: svgWidth || width + margin.left + margin.right,\n          height: svgHeight || height + margin.top + margin.bottom,\n        }}\n        ref={svgRef}\n      >\n        <MainGroup margin={margin}>\n          {grid && (\n            <Grid\n              ref={node =>\n                d3Select(node).call(\n                  drawGrid(\n                    horizontal,\n                    xScale,\n                    height,\n                    yScale,\n                    width,\n                    xAxisTicks,\n                    yAxisTicks\n                  )\n                )\n              }\n            />\n          )}\n\n          {title && (\n            <Title margin={margin} width={width} height={height}>\n              {title}\n            </Title>\n          )}\n\n          {xAxisChartLabel && (\n            <Label axis=\"x\" margin={margin} width={width} height={height}>\n              {xAxisChartLabel}\n            </Label>\n          )}\n\n          {yAxisChartLabel && (\n            <Label axis=\"y\" margin={margin} width={width} height={height}>\n              {yAxisChartLabel}\n            </Label>\n          )}\n\n          {dataSource && (\n            <DataSource\n              dataSource={dataSource}\n              height={height}\n              margin={margin}\n              width={width}\n            />\n          )}\n\n          <DataGroup>\n            {data.map(({ name, value }, idx) => (\n              <BarDatum\n                key={idx}\n                datum={{\n                  name,\n                  value,\n                }}\n                color={getBaseColor(theme)}\n                x={xScale(name)}\n                y={yScale(value)}\n                width={xScale.bandwidth()}\n                height={height - yScale(value)}\n                onClick={onClick}\n                onMouseEnter={onMouseEnter}\n                onMouseLeave={onMouseLeave}\n                tooltip={tooltip}\n              />\n            ))}\n          </DataGroup>\n\n          <Axis\n            axis=\"x\"\n            position={{ x: 0, y: height }}\n            ref={node => {\n              d3Select(node).call(\n                d3AxisBottom(xScale)\n                  .ticks(xAxisTicks)\n                  .tickFormat(isDates ? timeFormat : null)\n              );\n              xAxisLabelRotation && rotateXLabels(id, xAxisLabelRotationValue);\n            }}\n          />\n\n          <Axis\n            axis=\"y\"\n            ref={node =>\n              d3Select(node).call(d3AxisLeft(yScale).ticks(yAxisTicks))\n            }\n          />\n        </MainGroup>\n      </SVG>\n    </GraphContext.Provider>\n  );\n};\n\nexport default Bar;\n"],"names":["Bar","aspectRatio","ASPECT_RATIO","chartData","data","dataSource","dateFormat","TIME_FORMAT","grid","height","svgHeight","undefined","horizontal","margin","MARGIN","onClick","identity","onMouseEnter","onMouseLeave","responsive","staticTooltip","theme","THEME","title","tooltip","width","svgWidth","xAxisChartLabel","xAxisLabelRotation","xAxisLabelRotationValue","ROTATION","xAxisTicks","X_TICKS","padding","xScalePadding","SCALE_PADDING","yAxisChartLabel","yAxisTicks","Y_TICKS","svgRef","useRef","useState","getId","id","timeFormat","d3TimeFormat","SIZE","isSizeSet","setSize","setupData","isDates","xScale","d3ScaleBand","domain","map","name","range","yScale","d3ScaleLinear","getMax","value","handleSize","offsetWidth","current","parentElement","getSize","left","right","useResize","node","top","bottom","d3Select","call","drawGrid","idx","getBaseColor","bandwidth","x","y","d3AxisBottom","ticks","tickFormat","rotateXLabels","d3AxisLeft"],"mappings":"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"}