{"version":3,"file":"StackedArea.js","sources":["../src/StackedArea.js"],"sourcesContent":["import React, { useEffect, useMemo, useRef, useState } from 'react';\nimport identity from 'ramda/src/identity';\nimport { axisBottom as d3AxisBottom, axisLeft as d3AxisLeft } from 'd3-axis';\nimport { select as d3Select } from 'd3-selection';\nimport { area as d3Area } from 'd3-shape';\nimport { Axis, Grid, Label, Path, SVG } from './components';\nimport {\n  appendStackedValues,\n  buildStack,\n  bySeries,\n  classify,\n  debounce,\n  drawGrid,\n  getId,\n  getMax,\n  getStackedMax,\n  getSeries,\n  getSize,\n  getXScale,\n  getYScale,\n  palette,\n  rotateXLabels,\n  setLineType,\n  setupData,\n  toStackedForm,\n} from './utils';\nimport {\n  ASPECT_RATIO,\n  LINE_TYPE,\n  MARGIN,\n  ROTATION,\n  SCALE_BAND,\n  SCALE_LINEAR,\n  SCALE_TIME,\n  SIZE,\n  THEME,\n  TICKS,\n} from './utils/constants';\n\nconst StackedArea = ({\n  aspectRatio = ASPECT_RATIO,\n  data: chartData,\n  grid,\n  height: svgHeight = undefined,\n  isHorizontal,\n  lineSeries = [],\n  lineType = LINE_TYPE,\n  lineTypeOption = null,\n  margin = MARGIN,\n  onClick = identity,\n  onMouseEnter = identity,\n  onMouseLeave = identity,\n  responsive = false,\n  theme = THEME,\n  ticks = TICKS,\n  width: svgWidth = undefined,\n  xAxisLabel,\n  xAxisLabelRotation,\n  xAxisLabelRotationValue = ROTATION,\n  yAxisLabel,\n}) => {\n  const svgRef = useRef();\n  const [id] = useState(getId('stacked-area'));\n  const [{ width, height, isSizeSet }, setSize] = useState(SIZE);\n  let [isDates, data] = useMemo(() => setupData(chartData), chartData);\n  data = useMemo(\n    () =>\n      appendStackedValues(\n        buildStack(getSeries(data))(toStackedForm(data)),\n        data\n      ),\n    data\n  );\n\n  const xScale = getXScale(isDates ? SCALE_TIME : SCALE_BAND, data, width);\n  const yScale = getYScale(SCALE_LINEAR, getMax(getStackedMax(data)), height);\n\n  const area = d3Area()\n    .curve(setLineType(lineType, lineTypeOption))\n    .x(({ name }) => xScale(name))\n    .y0(({ stackedValues }) => yScale(stackedValues[0]))\n    .y1(({ stackedValues }) => yScale(stackedValues[1]));\n\n  const handleSize = () => {\n    const offsetWidth = svgRef.current.parentElement.offsetWidth;\n    if ((svgWidth || svgHeight) && !isSizeSet) {\n      setSize({\n        ...getSize(svgWidth, svgHeight, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    } else if (offsetWidth !== svgWidth - (margin.left + margin.right)) {\n      setSize({\n        ...getSize(offsetWidth, undefined, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    }\n  };\n\n  const handleResize = debounce(handleSize)();\n\n  useEffect(() => {\n    handleSize();\n    responsive && window.addEventListener('resize', handleResize);\n\n    return () => {\n      responsive && window.removeEventListener('resize', handleResize);\n    };\n  }, []);\n\n  return (\n    <SVG\n      identifier={id}\n      size={{\n        width: svgWidth || width + margin.left + margin.right,\n        height: svgHeight || height + margin.top + margin.bottom,\n      }}\n      ref={svgRef}\n    >\n      <g\n        className=\"silky-charts-container\"\n        transform={`translate(${margin.left}, ${margin.top})`}\n      >\n        {grid && (\n          <Grid\n            ref={node =>\n              d3Select(node).call(\n                drawGrid(isHorizontal, xScale, height, yScale, width, ticks)\n              )\n            }\n          />\n        )}\n\n        {xAxisLabel && (\n          <Label axis=\"x\" margin={margin} width={width} height={height}>\n            {xAxisLabel}\n          </Label>\n        )}\n\n        {yAxisLabel && (\n          <Label axis=\"y\" margin={margin} width={width} height={height}>\n            {yAxisLabel}\n          </Label>\n        )}\n\n        {bySeries(data).map(([series, datum], idx) => (\n          <g className={`${classify(series)}-layer`} key={idx}>\n            <Path\n              chart=\"stacked-area\"\n              fillColor={palette.themes[theme].base[idx]}\n              d={area(datum)}\n              strokeWidth={0}\n              onClick={onClick}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n            />\n          </g>\n        ))}\n\n        <Axis\n          axis=\"x\"\n          position={{ x: 0, y: height }}\n          ref={node => {\n            d3Select(node).call(d3AxisBottom(xScale));\n            xAxisLabelRotation && rotateXLabels(id, xAxisLabelRotationValue);\n          }}\n        />\n        <Axis\n          axis=\"y\"\n          ref={node => d3Select(node).call(d3AxisLeft(yScale).ticks(ticks))}\n        />\n      </g>\n    </SVG>\n  );\n};\n\nexport default StackedArea;\n"],"names":["aspectRatio","ASPECT_RATIO","chartData","data","grid","height","svgHeight","undefined","isHorizontal","lineSeries","lineType","LINE_TYPE","lineTypeOption","margin","MARGIN","onClick","identity","onMouseEnter","onMouseLeave","responsive","theme","THEME","ticks","TICKS","width","svgWidth","xAxisLabel","xAxisLabelRotation","xAxisLabelRotationValue","ROTATION","yAxisLabel","svgRef","useRef","useState","getId","id","SIZE","isSizeSet","setSize","useMemo","setupData","isDates","appendStackedValues","buildStack","getSeries","toStackedForm","xScale","getXScale","SCALE_TIME","SCALE_BAND","yScale","getYScale","SCALE_LINEAR","getMax","getStackedMax","area","d3Area","curve","setLineType","x","name","y0","stackedValues","y1","handleSize","offsetWidth","current","parentElement","left","right","getSize","handleResize","debounce","useEffect","window","addEventListener","removeEventListener","React","SVG","identifier","size","top","bottom","ref","className","transform","Grid","node","d3Select","call","drawGrid","Label","axis","bySeries","map","idx","series","datum","classify","key","Path","chart","fillColor","palette","themes","base","d","strokeWidth","Axis","position","y","d3AxisBottom","rotateXLabels","d3AxisLeft"],"mappings":"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"}