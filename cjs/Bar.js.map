{"version":3,"file":"Bar.js","sources":["../src/Bar.js"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport { axisBottom as d3AxisBottom, axisLeft as d3AxisLeft } from 'd3-axis';\nimport {\n  scaleBand as d3ScaleBand,\n  scaleLinear as d3ScaleLinear,\n} from 'd3-scale';\nimport { select as d3Select } from 'd3-selection';\nimport { timeFormat as d3TimeFormat } from 'd3-time-format';\nimport identity from 'ramda/src/identity';\nimport {\n  Axis,\n  BarDatum,\n  DataGroup,\n  Grid,\n  Label,\n  MainGroup,\n  DataSource,\n  SVG,\n  Title,\n} from './components';\nimport useResize from './hooks/useResize';\nimport {\n  drawGrid,\n  getBaseColor,\n  getId,\n  getMax,\n  getSize,\n  rotateXLabels,\n  setupData,\n} from './utils';\nimport {\n  ASPECT_RATIO,\n  MARGIN,\n  ROTATION,\n  SCALE_PADDING,\n  SIZE,\n  THEME,\n  TICKS,\n  TIME_FORMAT,\n} from './utils/constants';\n\nconst Bar = ({\n  aspectRatio = ASPECT_RATIO,\n  data: chartData,\n  dataSource,\n  dateFormat = TIME_FORMAT,\n  grid,\n  height: svgHeight = undefined,\n  horizontal,\n  margin = MARGIN,\n  onClick = identity,\n  onMouseEnter = identity,\n  onMouseLeave = identity,\n  responsive,\n  theme = THEME,\n  title,\n  tooltip,\n  width: svgWidth = undefined,\n  xAxisChartLabel,\n  xAxisLabelRotation,\n  xAxisLabelRotationValue = ROTATION,\n  xAxisTicks = TICKS,\n  padding: xScalePadding = SCALE_PADDING,\n  yAxisChartLabel,\n  yAxisTicks = TICKS,\n}) => {\n  const svgRef = useRef();\n  const [id] = useState(getId('bar'));\n  const timeFormat = d3TimeFormat(dateFormat);\n  const [{ width, height, isSizeSet }, setSize] = useState(SIZE);\n  const [isDates, data] = setupData(chartData);\n\n  const xScale = d3ScaleBand()\n    .domain(data.map(({ name }) => name))\n    .range([0, width])\n    .padding(xScalePadding);\n\n  const yScale = d3ScaleLinear()\n    .domain([0, getMax(data.map(({ value }) => value))])\n    .range([height, 0]);\n\n  const handleSize = () => {\n    const offsetWidth = svgRef.current.parentElement.offsetWidth;\n    if ((svgWidth || svgHeight) && !isSizeSet) {\n      setSize({\n        ...getSize(svgWidth, svgHeight, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    } else if (offsetWidth !== svgWidth - (margin.left + margin.right)) {\n      setSize({\n        ...getSize(offsetWidth, undefined, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    }\n  };\n\n  useResize(responsive, handleSize);\n\n  return (\n    <SVG\n      identifier={id}\n      size={{\n        width: svgWidth || width + margin.left + margin.right,\n        height: svgHeight || height + margin.top + margin.bottom,\n      }}\n      ref={svgRef}\n    >\n      <MainGroup margin={margin}>\n        {grid && (\n          <Grid\n            ref={node =>\n              d3Select(node).call(\n                drawGrid(\n                  horizontal,\n                  xScale,\n                  height,\n                  yScale,\n                  width,\n                  xAxisTicks,\n                  yAxisTicks\n                )\n              )\n            }\n          />\n        )}\n\n        {title && (\n          <Title margin={margin} width={width} height={height}>\n            {title}\n          </Title>\n        )}\n\n        {xAxisChartLabel && (\n          <Label axis=\"x\" margin={margin} width={width} height={height}>\n            {xAxisChartLabel}\n          </Label>\n        )}\n\n        {yAxisChartLabel && (\n          <Label axis=\"y\" margin={margin} width={width} height={height}>\n            {yAxisChartLabel}\n          </Label>\n        )}\n\n        {dataSource && (\n          <DataSource\n            dataSource={dataSource}\n            height={height}\n            margin={margin}\n            width={width}\n          />\n        )}\n\n        <DataGroup>\n          {data.map(({ name, value }, idx) => (\n            <BarDatum\n              key={idx}\n              datum={{\n                name,\n                value,\n              }}\n              color={getBaseColor(theme)}\n              x={xScale(name)}\n              y={yScale(value)}\n              width={xScale.bandwidth()}\n              height={height - yScale(value)}\n              onClick={onClick}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n              tooltip={tooltip}\n            />\n          ))}\n        </DataGroup>\n\n        <Axis\n          axis=\"x\"\n          position={{ x: 0, y: height }}\n          ref={node => {\n            d3Select(node).call(\n              d3AxisBottom(xScale)\n                .ticks(xAxisTicks)\n                .tickFormat(isDates ? timeFormat : null)\n            );\n            xAxisLabelRotation && rotateXLabels(id, xAxisLabelRotationValue);\n          }}\n        />\n\n        <Axis\n          axis=\"y\"\n          ref={node =>\n            d3Select(node).call(d3AxisLeft(yScale).ticks(yAxisTicks))\n          }\n        />\n      </MainGroup>\n    </SVG>\n  );\n};\n\nexport default Bar;\n"],"names":["Bar","aspectRatio","ASPECT_RATIO","chartData","data","dataSource","dateFormat","TIME_FORMAT","grid","height","svgHeight","undefined","horizontal","margin","MARGIN","onClick","identity","onMouseEnter","onMouseLeave","responsive","theme","THEME","title","tooltip","width","svgWidth","xAxisChartLabel","xAxisLabelRotation","xAxisLabelRotationValue","ROTATION","xAxisTicks","TICKS","padding","xScalePadding","SCALE_PADDING","yAxisChartLabel","yAxisTicks","svgRef","useRef","useState","getId","id","timeFormat","d3TimeFormat","SIZE","isSizeSet","setSize","setupData","isDates","xScale","d3ScaleBand","domain","map","name","range","yScale","d3ScaleLinear","getMax","value","handleSize","offsetWidth","current","parentElement","getSize","left","right","useResize","React","SVG","top","bottom","MainGroup","Grid","node","d3Select","call","drawGrid","Title","Label","DataSource","DataGroup","idx","BarDatum","getBaseColor","bandwidth","Axis","x","y","d3AxisBottom","ticks","tickFormat","rotateXLabels","d3AxisLeft"],"mappings":"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"}