{"version":3,"file":"StackedArea.js","sources":["../src/StackedArea.js"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport { axisBottom as d3AxisBottom, axisLeft as d3AxisLeft } from 'd3-axis';\nimport {\n  scaleTime as d3ScaleTime,\n  scaleLinear as d3ScaleLinear,\n} from 'd3-scale';\nimport { select as d3Select } from 'd3-selection';\nimport { area as d3Area } from 'd3-shape';\nimport { timeFormat as d3TimeFormat } from 'd3-time-format';\nimport identity from 'ramda/src/identity';\nimport {\n  Axis,\n  DataSource,\n  Grid,\n  Label,\n  MainGroup,\n  Path,\n  SVG,\n  Title,\n} from './components';\nimport useResize from './hooks/useResize';\nimport {\n  appendStackedValues,\n  buildStack,\n  bySeries,\n  classify,\n  drawGrid,\n  extent,\n  getId,\n  getMax,\n  getStackedMax,\n  getSeries,\n  getSize,\n  palette,\n  rotateXLabels,\n  setLineType,\n  setupData,\n  toStackedForm,\n} from './utils';\nimport {\n  ASPECT_RATIO,\n  LINE_TYPE,\n  MARGIN,\n  ROTATION,\n  SIZE,\n  THEME,\n  TIME_FORMAT,\n  TICKS,\n} from './utils/constants';\n\nconst StackedArea = ({\n  aspectRatio = ASPECT_RATIO,\n  data: chartData,\n  dataSource,\n  dateFormat = TIME_FORMAT,\n  grid,\n  height: svgHeight = undefined,\n  horizontal,\n  lineType = LINE_TYPE,\n  lineTypeOption = null,\n  margin = MARGIN,\n  onClick = identity,\n  onMouseEnter = identity,\n  onMouseLeave = identity,\n  responsive = false,\n  theme = THEME,\n  title,\n  width: svgWidth = undefined,\n  xAxisChartLabel,\n  xAxisLabelRotation,\n  xAxisLabelRotationValue = ROTATION,\n  xAxisTicks = TICKS,\n  yAxisChartLabel,\n  yAxisTicks = TICKS,\n}) => {\n  const svgRef = useRef(null);\n  const [id] = useState(getId('stacked-area'));\n  const timeFormat = d3TimeFormat(dateFormat);\n  const [{ width, height, isSizeSet }, setSize] = useState(SIZE);\n  let [isDates, data] = setupData(chartData);\n  data = appendStackedValues(\n    buildStack(getSeries(data))(toStackedForm(data)),\n    data\n  );\n\n  if (!isDates) {\n    throw new TypeError(\n      'StackedArea charts only accept valid dates in the \"name\" section of the dataset.'\n    );\n  }\n\n  const xScale = d3ScaleTime()\n    .domain(extent(data.map(({ name }) => name)))\n    .range([0, width]);\n\n  const yScale = d3ScaleLinear()\n    .domain([0, getMax(getStackedMax(data))])\n    .range([height, 0]);\n\n  const area = d3Area()\n    .curve(setLineType(lineType, lineTypeOption))\n    .x(({ name }) => xScale(name))\n    .y0(({ stackedValues }) => yScale(stackedValues[0]))\n    .y1(({ stackedValues }) => yScale(stackedValues[1]));\n\n  const handleSize = () => {\n    const offsetWidth = svgRef.current.parentElement.offsetWidth;\n    if ((svgWidth || svgHeight) && !isSizeSet) {\n      setSize({\n        ...getSize(svgWidth, svgHeight, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    } else if (offsetWidth !== svgWidth - (margin.left + margin.right)) {\n      setSize({\n        ...getSize(offsetWidth, undefined, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    }\n  };\n\n  useResize(responsive, handleSize);\n\n  return (\n    <SVG\n      identifier={id}\n      size={{\n        width: svgWidth || width + margin.left + margin.right,\n        height: svgHeight || height + margin.top + margin.bottom,\n      }}\n      ref={svgRef}\n    >\n      <MainGroup margin={margin}>\n        {grid && (\n          <Grid\n            ref={node =>\n              d3Select(node).call(\n                drawGrid(\n                  horizontal,\n                  xScale,\n                  height,\n                  yScale,\n                  width,\n                  xAxisTicks,\n                  yAxisTicks\n                )\n              )\n            }\n          />\n        )}\n\n        {title && (\n          <Title margin={margin} width={width}>\n            {title}\n          </Title>\n        )}\n\n        {xAxisChartLabel && (\n          <Label axis=\"x\" margin={margin} width={width} height={height}>\n            {xAxisChartLabel}\n          </Label>\n        )}\n\n        {yAxisChartLabel && (\n          <Label axis=\"y\" margin={margin} width={width} height={height}>\n            {yAxisChartLabel}\n          </Label>\n        )}\n\n        {dataSource && (\n          <DataSource\n            dataSource={dataSource}\n            height={height}\n            margin={margin}\n            width={width}\n          />\n        )}\n\n        {bySeries(data).map(([series, datum], idx) => (\n          <g className={`${classify(series)}-layer`} key={idx}>\n            <Path\n              chart=\"stacked-area\"\n              fillColor={palette.themes[theme][idx]}\n              d={area(datum)}\n              strokeWidth={0}\n              onClick={onClick}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n            />\n          </g>\n        ))}\n\n        <Axis\n          axis=\"x\"\n          position={{ x: 0, y: height }}\n          ref={node => {\n            d3Select(node).call(\n              d3AxisBottom(xScale)\n                .ticks(xAxisTicks)\n                .tickFormat(isDates ? timeFormat : null)\n            );\n            xAxisLabelRotation && rotateXLabels(id, xAxisLabelRotationValue);\n          }}\n        />\n\n        <Axis\n          axis=\"y\"\n          ref={node =>\n            d3Select(node).call(d3AxisLeft(yScale).ticks(yAxisTicks))\n          }\n        />\n      </MainGroup>\n    </SVG>\n  );\n};\n\nexport default StackedArea;\n"],"names":["StackedArea","aspectRatio","ASPECT_RATIO","chartData","data","dataSource","dateFormat","TIME_FORMAT","grid","height","svgHeight","undefined","horizontal","lineType","LINE_TYPE","lineTypeOption","margin","MARGIN","onClick","identity","onMouseEnter","onMouseLeave","responsive","theme","THEME","title","width","svgWidth","xAxisChartLabel","xAxisLabelRotation","xAxisLabelRotationValue","ROTATION","xAxisTicks","TICKS","yAxisChartLabel","yAxisTicks","svgRef","useRef","useState","getId","id","timeFormat","d3TimeFormat","SIZE","isSizeSet","setSize","setupData","isDates","appendStackedValues","buildStack","getSeries","toStackedForm","TypeError","xScale","d3ScaleTime","domain","extent","map","name","range","yScale","d3ScaleLinear","getMax","getStackedMax","area","d3Area","curve","setLineType","x","y0","stackedValues","y1","handleSize","offsetWidth","current","parentElement","getSize","left","right","useResize","React","SVG","top","bottom","MainGroup","Grid","node","d3Select","call","drawGrid","Title","Label","DataSource","bySeries","idx","series","datum","classify","Path","palette","themes","Axis","y","d3AxisBottom","ticks","tickFormat","rotateXLabels","d3AxisLeft"],"mappings":"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"}