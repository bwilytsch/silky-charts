{"version":3,"file":"StackedArea.js","sources":["../src/StackedArea.js"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport identity from 'ramda/src/identity';\nimport { axisBottom as d3AxisBottom, axisLeft as d3AxisLeft } from 'd3-axis';\nimport { select as d3Select } from 'd3-selection';\nimport { area as d3Area } from 'd3-shape';\nimport { Axis, Grid, Label, Path, SVG } from './components';\nimport {\n  appendStackedValues,\n  buildStack,\n  bySeries,\n  classify,\n  debounce,\n  drawGrid,\n  getId,\n  getMax,\n  getStackedMax,\n  getSeries,\n  getSize,\n  getXScale,\n  getYScale,\n  palette,\n  rotateXLabels,\n  setLineType,\n  setupData,\n  toStackedForm,\n} from './utils';\nimport {\n  ASPECT_RATIO,\n  LINE_TYPE,\n  MARGIN,\n  ROTATION,\n  SCALE_BAND,\n  SCALE_LINEAR,\n  SCALE_TIME,\n  SIZE,\n  THEME,\n  TICKS,\n} from './utils/constants';\n\nconst StackedArea = ({\n  aspectRatio = ASPECT_RATIO,\n  data: chartData,\n  grid,\n  height: svgHeight = undefined,\n  horizontal,\n  lineType = LINE_TYPE,\n  lineTypeOption = null,\n  margin = MARGIN,\n  onClick = identity,\n  onMouseEnter = identity,\n  onMouseLeave = identity,\n  responsive = false,\n  theme = THEME,\n  ticks = TICKS,\n  width: svgWidth = undefined,\n  xAxisChartLabel,\n  xAxisLabelRotation,\n  xAxisLabelRotationValue = ROTATION,\n  yAxisChartLabel,\n}) => {\n  const svgRef = useRef();\n  const [id] = useState(getId('stacked-area'));\n  const [{ width, height, isSizeSet }, setSize] = useState(SIZE);\n  let [isDates, data] = setupData(chartData);\n  data = appendStackedValues(\n    buildStack(getSeries(data))(toStackedForm(data)),\n    data\n  );\n\n  const xScale = getXScale(isDates ? SCALE_TIME : SCALE_BAND, data, width);\n  const yScale = getYScale(SCALE_LINEAR, getMax(getStackedMax(data)), height);\n\n  const area = d3Area()\n    .curve(setLineType(lineType, lineTypeOption))\n    .x(({ name }) => xScale(name))\n    .y0(({ stackedValues }) => yScale(stackedValues[0]))\n    .y1(({ stackedValues }) => yScale(stackedValues[1]));\n\n  const handleSize = () => {\n    const offsetWidth = svgRef.current.parentElement.offsetWidth;\n    if ((svgWidth || svgHeight) && !isSizeSet) {\n      setSize({\n        ...getSize(svgWidth, svgHeight, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    } else if (offsetWidth !== svgWidth - (margin.left + margin.right)) {\n      setSize({\n        ...getSize(offsetWidth, undefined, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    }\n  };\n\n  const handleResize = debounce(handleSize)();\n\n  useEffect(() => {\n    handleSize();\n    responsive && window.addEventListener('resize', handleResize);\n\n    return () => {\n      responsive && window.removeEventListener('resize', handleResize);\n    };\n  }, [handleSize, responsive, handleResize]);\n\n  return (\n    <SVG\n      identifier={id}\n      size={{\n        width: svgWidth || width + margin.left + margin.right,\n        height: svgHeight || height + margin.top + margin.bottom,\n      }}\n      ref={svgRef}\n    >\n      <g\n        className=\"silky-charts-container\"\n        transform={`translate(${margin.left}, ${margin.top})`}\n      >\n        {grid && (\n          <Grid\n            ref={node =>\n              d3Select(node).call(\n                drawGrid(horizontal, xScale, height, yScale, width, ticks)\n              )\n            }\n          />\n        )}\n\n        {xAxisChartLabel && (\n          <Label axis=\"x\" margin={margin} width={width} height={height}>\n            {xAxisChartLabel}\n          </Label>\n        )}\n\n        {yAxisChartLabel && (\n          <Label axis=\"y\" margin={margin} width={width} height={height}>\n            {yAxisChartLabel}\n          </Label>\n        )}\n\n        {bySeries(data).map(([series, datum], idx) => (\n          <g className={`${classify(series)}-layer`} key={idx}>\n            <Path\n              chart=\"stacked-area\"\n              fillColor={palette.themes[theme][idx]}\n              d={area(datum)}\n              strokeWidth={0}\n              onClick={onClick}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n            />\n          </g>\n        ))}\n\n        <Axis\n          axis=\"x\"\n          position={{ x: 0, y: height }}\n          ref={node => {\n            d3Select(node).call(d3AxisBottom(xScale));\n            xAxisLabelRotation && rotateXLabels(id, xAxisLabelRotationValue);\n          }}\n        />\n        <Axis\n          axis=\"y\"\n          ref={node => d3Select(node).call(d3AxisLeft(yScale).ticks(ticks))}\n        />\n      </g>\n    </SVG>\n  );\n};\n\nexport default StackedArea;\n"],"names":["StackedArea","aspectRatio","ASPECT_RATIO","chartData","data","grid","height","svgHeight","undefined","horizontal","lineType","LINE_TYPE","lineTypeOption","margin","MARGIN","onClick","identity","onMouseEnter","onMouseLeave","responsive","theme","THEME","ticks","TICKS","width","svgWidth","xAxisChartLabel","xAxisLabelRotation","xAxisLabelRotationValue","ROTATION","yAxisChartLabel","svgRef","useRef","useState","getId","id","SIZE","isSizeSet","setSize","setupData","isDates","appendStackedValues","buildStack","getSeries","toStackedForm","xScale","getXScale","SCALE_TIME","SCALE_BAND","yScale","getYScale","SCALE_LINEAR","getMax","getStackedMax","area","d3Area","curve","setLineType","x","name","y0","stackedValues","y1","handleSize","offsetWidth","current","parentElement","getSize","left","right","handleResize","debounce","useEffect","window","addEventListener","removeEventListener","React","SVG","top","bottom","Grid","node","d3Select","call","drawGrid","Label","bySeries","map","idx","series","datum","classify","Path","palette","themes","Axis","y","d3AxisBottom","rotateXLabels","d3AxisLeft"],"mappings":"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"}