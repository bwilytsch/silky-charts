{"version":3,"file":"BarLine.js","sources":["../src/BarLine.js"],"sourcesContent":["import React, { useRef, useState } from 'react';\nimport { axisBottom as d3AxisBottom, axisLeft as d3AxisLeft } from 'd3-axis';\nimport {\n  scaleBand as d3ScaleBand,\n  scaleLinear as d3ScaleLinear,\n} from 'd3-scale';\nimport { select as d3Select } from 'd3-selection';\nimport { line as d3Line } from 'd3-shape';\nimport { timeFormat as d3TimeFormat } from 'd3-time-format';\nimport head from 'ramda/src/head';\nimport identity from 'ramda/src/identity';\nimport {\n  Axis,\n  Grid,\n  Label,\n  LineDatum,\n  MainGroup,\n  DataSource,\n  StackedBarDatum,\n  SVG,\n  Title,\n} from './components';\nimport useResize from './hooks/useResize';\nimport {\n  buildStack,\n  drawGrid,\n  getId,\n  getLineDataForSeries,\n  getMax,\n  getStackedMax,\n  getSize,\n  palette,\n  rotateXLabels,\n  setLineType,\n  setupData,\n  toStackedForm,\n} from './utils';\nimport {\n  ASPECT_RATIO,\n  LINE_TYPE,\n  MARGIN,\n  ROTATION,\n  SCALE_PADDING,\n  SECONDARY_THEME,\n  SIZE,\n  THEME,\n  TICKS,\n  TIME_FORMAT,\n} from './utils/constants';\n\nconst BarLine = ({\n  aspectRatio = ASPECT_RATIO,\n  data: chartData,\n  dataSource,\n  dateFormat = TIME_FORMAT,\n  grid,\n  height: svgHeight = undefined,\n  horizontal,\n  lineSeries = [],\n  lineType = LINE_TYPE,\n  lineTypeOption = null,\n  margin = MARGIN,\n  onClick = identity,\n  onMouseEnter = identity,\n  onMouseLeave = identity,\n  padding: xScalePadding = SCALE_PADDING,\n  responsive,\n  secondaryTheme = SECONDARY_THEME,\n  stackedSeries = [],\n  theme = THEME,\n  title,\n  tooltip,\n  width: svgWidth = undefined,\n  xAxisChartLabel,\n  xAxisLabelRotation,\n  xAxisLabelRotationValue = ROTATION,\n  xAxisTicks = TICKS,\n  yAxisChartLabel,\n  yAxisTicks = TICKS,\n}) => {\n  const svgRef = useRef();\n  const [id] = useState(getId('bar-line'));\n  const timeFormat = d3TimeFormat(dateFormat);\n  const [{ width, height, isSizeSet }, setSize] = useState(SIZE);\n  const [isDates, data] = setupData(chartData);\n  const stack = buildStack(stackedSeries)(toStackedForm(data));\n\n  const xScale = d3ScaleBand()\n    .domain(data.map(({ name }) => name))\n    .range([0, width])\n    .padding(xScalePadding);\n\n  const yScale = d3ScaleLinear()\n    .domain([0, getMax(getStackedMax(data, stackedSeries))])\n    .range([height, 0]);\n\n  const line = d3Line()\n    .curve(setLineType(lineType, lineTypeOption))\n    .x(({ name }) => xScale(name) + xScale.bandwidth() / 2)\n    .y(({ value }) => yScale(value));\n\n  const lineData = getLineDataForSeries(lineSeries, data);\n\n  const handleSize = () => {\n    const offsetWidth = svgRef.current.parentElement.offsetWidth;\n    if ((svgWidth || svgHeight) && !isSizeSet) {\n      setSize({\n        ...getSize(svgWidth, svgHeight, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    } else if (offsetWidth !== svgWidth - (margin.left + margin.right)) {\n      setSize({\n        ...getSize(offsetWidth, undefined, margin, aspectRatio),\n        isSizeSet: true,\n      });\n    }\n  };\n\n  useResize(responsive, handleSize);\n\n  return (\n    <SVG\n      identifier={id}\n      size={{\n        width: svgWidth || width + margin.left + margin.right,\n        height: svgHeight || height + margin.top + margin.bottom,\n      }}\n      ref={svgRef}\n    >\n      <MainGroup margin={margin}>\n        {grid && (\n          <Grid\n            ref={node =>\n              d3Select(node).call(\n                drawGrid(\n                  horizontal,\n                  xScale,\n                  height,\n                  yScale,\n                  width,\n                  xAxisTicks,\n                  yAxisTicks\n                )\n              )\n            }\n          />\n        )}\n\n        {title && (\n          <Title margin={margin} width={width}>\n            {title}\n          </Title>\n        )}\n\n        {xAxisChartLabel && (\n          <Label axis=\"x\" margin={margin} width={width} height={height}>\n            {xAxisChartLabel}\n          </Label>\n        )}\n\n        {yAxisChartLabel && (\n          <Label axis=\"y\" margin={margin} width={width} height={height}>\n            {yAxisChartLabel}\n          </Label>\n        )}\n\n        {dataSource && (\n          <DataSource\n            dataSource={dataSource}\n            height={height}\n            margin={margin}\n            width={width}\n          />\n        )}\n\n        <StackedBarDatum\n          data={data}\n          series={stack}\n          theme={theme}\n          x={xScale}\n          y={yScale}\n          width={width}\n          height={height}\n          onClick={onClick}\n          onMouseEnter={onMouseEnter}\n          onMouseLeave={onMouseLeave}\n          tooltip={tooltip}\n        />\n\n        <Axis\n          axis=\"x\"\n          position={{ x: 0, y: height }}\n          ref={node => {\n            d3Select(node).call(\n              d3AxisBottom(xScale)\n                .ticks(xAxisTicks)\n                .tickFormat(isDates ? timeFormat : null)\n            );\n            xAxisLabelRotation && rotateXLabels(id, xAxisLabelRotationValue);\n          }}\n        />\n\n        <Axis\n          axis=\"y\"\n          ref={node =>\n            d3Select(node).call(d3AxisLeft(yScale).ticks(yAxisTicks))\n          }\n        />\n\n        {lineData.map((datum, idx) => (\n          <g className={`${head(datum)['series']}-layer`} key={idx}>\n            <LineDatum\n              chart=\"bar-line\"\n              data={datum}\n              color={palette.themes[secondaryTheme][idx]}\n              d={line(datum)}\n              xScale={xScale}\n              yScale={yScale}\n              onClick={onClick}\n              onMouseEnter={onMouseEnter}\n              onMouseLeave={onMouseLeave}\n              tooltip={tooltip}\n            />\n          </g>\n        ))}\n      </MainGroup>\n    </SVG>\n  );\n};\n\nexport default BarLine;\n"],"names":["BarLine","aspectRatio","ASPECT_RATIO","chartData","data","dataSource","dateFormat","TIME_FORMAT","grid","height","svgHeight","undefined","horizontal","lineSeries","lineType","LINE_TYPE","lineTypeOption","margin","MARGIN","onClick","identity","onMouseEnter","onMouseLeave","padding","xScalePadding","SCALE_PADDING","responsive","secondaryTheme","SECONDARY_THEME","stackedSeries","theme","THEME","title","tooltip","width","svgWidth","xAxisChartLabel","xAxisLabelRotation","xAxisLabelRotationValue","ROTATION","xAxisTicks","TICKS","yAxisChartLabel","yAxisTicks","svgRef","useRef","useState","getId","id","timeFormat","d3TimeFormat","SIZE","isSizeSet","setSize","setupData","isDates","stack","buildStack","toStackedForm","xScale","d3ScaleBand","domain","map","name","range","yScale","d3ScaleLinear","getMax","getStackedMax","line","d3Line","curve","setLineType","x","bandwidth","y","value","lineData","getLineDataForSeries","handleSize","offsetWidth","current","parentElement","getSize","left","right","useResize","React","SVG","top","bottom","MainGroup","Grid","node","d3Select","call","drawGrid","Title","Label","DataSource","StackedBarDatum","Axis","d3AxisBottom","ticks","tickFormat","rotateXLabels","d3AxisLeft","datum","idx","head","LineDatum","palette","themes"],"mappings":"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"}